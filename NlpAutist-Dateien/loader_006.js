(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{"3GUV":function(e,t,s){"use strict";var i=s("ERkP"),n=s("rHpw"),r=s("MWbm");class o extends i.Component{shouldComponentUpdate(){return!1}render(){return i.createElement(r.a,{style:a.root})}}const a=n.a.create(e=>({root:{height:5*parseInt(e.lineHeight,10)+"rem"}}));t.a=o},"5UID":function(e,t,s){"use strict";var i=s("ERkP"),n=s("3XMw"),r=s.n(n),o=s("rHpw"),a=(s("aWzz"),s("+/1j")),c=s("MWbm");const l=r.a.e5b0063d;let h=0;class d extends i.Component{constructor(){super(),this._listDomId="accessible-list-"+h,h+=1}render(){const{children:e,title:t}=this.props,s=l({title:t});return i.createElement(c.a,{accessibilityRole:"region","aria-labelledby":this._listDomId},i.createElement(a.a,{accessibilityRole:"heading","aria-level":1,nativeID:this._listDomId,style:o.a.visuallyHidden},t),i.createElement(c.a,{accessibilityLabel:s},e))}}t.a=d},JsJV:function(e,t,s){"use strict";var i=s("6/RC"),n=s("tI3i"),r=s.n(n),o=i.canUseDOM?window.location.href:"",a={addEventListener:function(){},removeEventListener:function(){},canOpenURL:function(){return Promise.resolve(!0)},getInitialURL:function(){return Promise.resolve(o)},openURL:function(e){try{return c(e),Promise.resolve()}catch(e){return Promise.reject(e)}},_validateURL:function(e){r()("string"==typeof e,"Invalid URL: should be a string. Was: "+e),r()(e,"Invalid URL: cannot be empty")}},c=function(e){i.canUseDOM&&(window.location=new URL(e,window.location).toString())};t.a=a},ainm:function(e,t,s){"use strict";s.r(t),s.d(t,"TimelineRenderer",(function(){return de}));s("IAdD"),s("kYxP");var i=s("KEM+"),n=s.n(i),r=s("n+Zb"),o=s("ERkP"),a=s("7nmT"),c=s.n(a),l=s("nfVA"),h=s("EhiH"),d=s("zrc3");const p=(e,t)=>{const s=Object(h.a)(e,e=>t.has(e.entryId));return s?s.entryId:void 0};var m=s("5UID"),u=s("6/RC"),_=s("1YZw"),y=s("rxPX"),b=Object(y.a)().propsFromActions(()=>({addToast:_.b})).withAnalytics(),g=s("KNCp"),f=s("lUZE");var v=Object.freeze({Icon:"Icon",IconSmall:"IconSmall",FullWidth:"FullWidth"}),C=s("caTy"),I=s("TnY3"),E=s("TIdA"),w=s("A91F"),T=s("feu+"),R=s("JsJV"),x=s("MWbm"),S=s("oQhu"),A=s("fs1G"),L=s("rcen");class O extends o.PureComponent{constructor(...e){super(...e),n()(this,"_getGraphicProps",Object(S.a)((e,t)=>{const s=e?({style:t})=>o.createElement(x.a,{style:t},o.createElement(E.a,{accessibilityLabel:"",aspectMode:w.a.exact(e.width/e.height),image:e})):f.a;let i="illustration";return e&&t!==v.IconSmall?t===v.FullWidth&&(i="illustrationFullWidth"):i="icon",{graphic:s,graphicDisplayMode:i}})),n()(this,"_scribeAction",(e,t)=>{const{analytics:s}=this.props,{action:i,component:n,element:r}=t||{};s.scribe({action:i||e,component:n||"cover",element:r})}),n()(this,"_handleDismiss",()=>{const{dismissInfo:e,processCallback:t}=this.props,{callbacks:s,clientEventInfo:i}=e||{};s&&s.forEach(e=>{t(e)}),e&&(this._scribeAction("dismiss",i),this.props.onClose())}),n()(this,"_handlePrimaryCtaClick",()=>{this._handleCtaClick(this.props.primaryCta,"primary_cta")}),n()(this,"_handleSecondaryCtaClick",()=>{this.props.secondaryCta&&this._handleCtaClick(this.props.secondaryCta,"secondary_cta")}),n()(this,"_handleCtaClick",({ctaBehavior:e,callbacks:t,clientEventInfo:s},i)=>{const{addToast:n,processCallback:r,history:o}=this.props;if(this.props.onClose(),this._scribeAction("click",Object.assign({element:i},s)),e.dismiss){const{dismiss:t}=e;t&&t.feedbackMessage&&n({text:t.feedbackMessage.text})}if(e.navigate){const{navigate:t}=e,s=t&&Object(C.b)(t.url);s&&(s.external?R.a.openURL(s.pathname):o.push(s.pathname))}t&&t.forEach(e=>r(e))})}componentDidMount(){this.props.onImpression&&this.props.onImpression()}render(){const{image:e,imageDisplayType:t,primaryText:s,primaryCta:i,secondaryText:n,secondaryCta:r,details:a,displayType:c,type:l,dismissInfo:h}=this.props,d=o.createElement(L.b,{entities:s.entities,text:s.text}),p=n?o.createElement(L.b,{entities:n.entities,text:n.text}):null;if(l===g.a.Full){const l=a?o.createElement(L.b,{entities:a.entities,text:a.text}):null,{graphic:m,graphicDisplayMode:u}=this._getGraphicProps(e,t);return o.createElement(T.a,{actionLabel:i.text,footer:l,footerAlign:a&&a.alignment===L.a.Center?"center":"left",graphic:m,graphicDisplayMode:u,headline:d,headlineAlign:s.alignment===L.a.Natural?"left":"center",isFullHeightOnMobile:!h&&"CenterCover"!==c,onAction:this._handlePrimaryCtaClick,onClose:this._handleDismiss,onTertiaryAction:this._handleSecondaryCtaClick,subtext:p,subtextAlign:n&&n.alignment===L.a.Natural?"left":"center",tertiaryActionLabel:r&&r.text,withCloseButton:!!h})}return o.createElement(T.a,{actionLabel:i.text,graphicDisplayMode:"none",headline:d,headlineAlign:s.alignment===L.a.Center?"center":"left",onAction:this._handlePrimaryCtaClick,onClose:A.a,onSecondaryAction:this._handleSecondaryCtaClick,secondaryActionLabel:r&&r.text,subtext:p,subtextAlign:n&&n.alignment===L.a.Center?"center":"left",withCloseButton:!1})}}n()(O,"defaultProps",{imageDisplayType:v.Icon});var D=Object(I.a)(b(O)),j=s("3GUV"),k=s("8UdT"),N=s("wrlS"),P=s("MDbM"),M=s("v//M"),U=(s("C1yv"),s("Qyxo"));class F{constructor(){this._lingerScribed={},this._appearance={}}processPositioningUpdate(e,t,s=Date.now()){const i=B(e,t);return this._lingerTransition(i,s)}flushLingerEvents(e=Date.now()){return this._detectScribeLingerEvents(this._appearance,{},e)}_lingerTransition(e,t){const s=this._appearance;return this._appearance=e.reduce((e,i)=>(e[i]=s[i]||{start:t,lingered:!1},e),{}),{allLingerEvents:this._detectAllLingerEvents(s,t),scribeLingerEvents:this._detectScribeLingerEvents(s,this._appearance,t)}}_detectAllLingerEvents(e,t){return Object.keys(e).reduce((s,i)=>{const{start:n,lingered:r}=e[i];return!r&&t-n>=500&&(s.push(i),this._appearance[i]&&(this._appearance[i]=Object.assign({},this._appearance[i],{lingered:!0}))),s},[])}_detectScribeLingerEvents(e,t,s){return Object.keys(e).reduce((i,n)=>{const{start:r}=e[n];return!t[n]&&!this._lingerScribed[n]&&s-r>=500&&(this._lingerScribed[n]=!0,i.push({id:n,start:r,end:s})),i},[])}}const B=(e,t)=>Object(U.a)(e,({id:e,rectangle:s})=>H(s,t)>=.5*s.getHeight()?e:void 0),H=(e,t)=>Math.max(0,Math.min(e.getBottom(),t.getBottom())-Math.max(e.getTop(),t.getTop()));var W=s("OrGc"),G=s("hACr"),V=s("xjVt"),K=s("EUHl"),z=s("aWzz"),J=s("IG4P"),q=s("iBK2"),Z=s("b1wW");s("rxtR");const Y=Object.freeze({ON_LINGER:"onLinger"});var Q=s("aITJ"),X=s("VPAj"),$=s("/NU0"),ee=s("iChn"),te=s("+d3d"),se=s("I7xG"),ie=s("rHpw"),ne=s("cFgU");const re=e=>e.entryId,oe=e=>e.sortIndex;const ae=Object(X.a)(o.createElement(j.a,null)),ce=new Map,le=()=>{const e=Q.a.isDesktopOS()?N.b.getValue("responsive_web_vs_config_desktop_assumed_item_height"):void 0;return Object($.a)(e)?e:void 0};let he;class de extends o.PureComponent{constructor(e){super(e),n()(this,"_entryRefs",new Map),n()(this,"_adjustFocusBy",e=>{this._shouldPreventKeyboardShortcuts()||this._updateFocus((t,s,i)=>{let n=t&&((e,t,s,i)=>{const n=e?Object(d.a)(s,t=>t.entryId===e):-1;if(n>=0){for(let e=n>=0?n+t:0;e>=0&&e<s.length;e+=t){const{entryId:t}=s[e];if(i.has(t))return t}}return n>=0?e:void 0})(t,e,s,this._entryRefs);if(!n&&this._scroller){const e=this._scroller.findTopmostVisibleId();n=e?((e,t,s)=>{const i=Object(d.a)(t,t=>t.entryId===e);let n;if(i>=0){const e=Object(h.a)(t,e=>s.has(e.entryId),i);n=e?e.entryId:void 0}return n||(n=p(t,s)),n})(e,s,this._entryRefs):p(s,this._entryRefs)}return n})}),n()(this,"_focusNext",()=>this._adjustFocusBy(1)),n()(this,"_focusPrevious",()=>this._adjustFocusBy(-1)),n()(this,"_handleCoverImpression",()=>{const{activeCover:e,scribeAction:t,processCallback:s,scribeNamespace:i}=this.props;if(!e)return;const{clientEventInfo:n,cover:{impressionCallbacks:r}}=e;r&&r.forEach(e=>s(e));let o=Object.assign({},i,{component:"cover",action:"impression"});n&&(o=Object.assign({},o,{component:n.component||o.component,element:n.element||o.element,action:n.action||o.action})),t(o)}),n()(this,"_handleDismissCover",()=>{this.props.clearActiveCover()}),n()(this,"_renderLoadBottom",Object(se.a)(this,e=>e.bottomFetchStatus,e=>e.onBottomRetry,(e,t)=>o.createElement(x.a,{style:pe.footer},o.createElement(M.a,{fetchStatus:e,onRequestRetry:t,render:ae})))),n()(this,"_refreshControlWrapper",e=>{const{canRefresh:t,refreshControl:s,topFetchStatus:i,onRefresh:n}=this.props;return s?o.createElement(s,{canRefresh:t,isRefreshing:i===P.a.LOADING,onRefresh:n},e):e}),n()(this,"_getCellRenderer",Object(S.a)((e,t)=>{let s;const i={module:t,renderEntry:e=>s(e),entryRef:this._setEntryRef};return s=t=>{const s=e.getHandler(t);return s&&s.render?s.render(t,i):null},s})),n()(this,"_setEntryRef",(e,t)=>{this._entryRefs.set(e,t)}),n()(this,"_getInitialFocusedEntry",Object(S.a)((e,t)=>t&&e.find(t))),n()(this,"_createEntryIndex",Object(S.a)(e=>Object(ee.a)(e,e=>e.entryId))),n()(this,"_handleBeforeWindowUnload",()=>{this._flushLingerScribes()}),n()(this,"isAtTop",()=>!!this._scroller&&this._scroller.scrollToTop()),n()(this,"scrollToTop",()=>{this._scroller&&(this._scroller.scrollToTop(),this._updateFocus((e,t,s)=>e?p(t,s):void 0,{block:"nearest"}))}),n()(this,"_shouldPreventKeyboardShortcuts",()=>{const{isModal:e,withKeyboardShortcuts:t}=this.props;return he&&!e||!t}),n()(this,"_handleRefreshKeyboardShortcut",Object(te.a)(()=>{this._shouldPreventKeyboardShortcuts()||this.refreshOrGoTop()},1e3)),n()(this,"_handleAtBottom",this._proximityHandler(()=>{this.props.onAtBottom&&this.props.onAtBottom()})),n()(this,"_handleNearBottom",this._proximityHandler(()=>{this.props.onNearBottom()})),n()(this,"_handleNearTop",this._proximityHandler(()=>{const{onNearTop:e}=this.props;e()})),n()(this,"_handleAtTop",this._proximityHandler(()=>{this.props.removeAlert&&this.props.removeAlert(),this.props.onAtTop&&this.props.onAtTop()})),n()(this,"_handleItemsRendered",this._proximityHandler(({viewport:e,positions:t})=>{const s=this._impressionTracker.processPositioningUpdate(t,e);this._scribeLingerEvents(s.scribeLingerEvents),this._handleOnLingerEvents(s.allLingerEvents)})),n()(this,"_handleOnLingerEvents",e=>{const{applyReactionInstructions:t}=this.props,s=this._getEntryIndex();e.forEach(e=>{const i=s[e];i&&t({entry:i,triggerName:Y.ON_LINGER})})}),n()(this,"_handlePositionRestored",()=>{this._positionedRestored=!0}),n()(this,"_scribeNewEntries",function(e){const t=u.canUseDOM?window.requestIdleCallback||window.requestAnimationFrame:A.a;return s=>{t(()=>{e(s)})}}(e=>{const{richScribeAction:t,scribeNamespace:s}=this.props,i=this._buildStreamScribeData(e);if(i.length>0){t(Object.assign({},s,{component:"stream",action:"results"}),{items:i})}})),n()(this,"_setScroller",e=>{this._scroller=e}),this._impressionTracker=new F}UNSAFE_componentWillReceiveProps(e){this.props.timelineId!==e.timelineId&&(this._flushLingerScribes(),this._impressionTracker=new F)}componentDidMount(){const{isModal:e,onRef:t}=this.props;this._initialize(),window.addEventListener("beforelogout",this._handleBeforeWindowUnload),window.addEventListener("beforeunload",this._handleBeforeWindowUnload),t&&t(this),e&&(he=!0)}componentWillUnmount(){const{isModal:e,onRef:t}=this.props;this._flushLingerScribes(),window.removeEventListener("beforelogout",this._handleBeforeWindowUnload),window.removeEventListener("beforeunload",this._handleBeforeWindowUnload),t&&t(void 0),e&&(he=!1)}componentDidUpdate(e){const{entries:t,handlerRegistry:s,timelineId:i,onRef:n}=this.props;i!==e.timelineId?this._initialize():t===e.entries&&s===e.handlerRegistry||this._scribeNewEntries(t),n&&n!==e.onRef&&n(this)}_updateFocus(e,t){const s=e(this._activeEntryId,this.props.entries,this._entryRefs);if(s!==this._activeEntryId){this._activeEntryId=s;const e=this._activeEntryId&&this._entryRefs.get(this._activeEntryId);e&&((e,t,s)=>{const i=c.a.findDOMNode(e),n=i&&i instanceof window.HTMLElement&&i.querySelector("a, [tabindex='0']");if(n){n.scrollIntoView(s),n.focus();const e=(t||l.a.root()).getRect().getTop();e>0&&window.scrollBy(0,-1*e)}})(e,this.context.viewport,t)}}render(){const{activeCover:e,anchoring:t,entries:s,handlerRegistry:i,showFooter:n,header:a,isInitialFocusEntry:c,nearStartProximityRatio:l,renderEmptyState:h,scrollerDisplayType:d,timelineId:p,title:u,module:_}=this.props,y=this.props.scroller,b=this._getInitialFocusedEntry(s,c);return this._refreshControlWrapper(this._shouldRenderEmptyState(s)?h():o.createElement(m.a,{title:u},e?this._renderActiveCover():null,this._renderPill(),o.createElement(G.a,{handlers:{[W.d.loadNewTweets]:this._handleRefreshKeyboardShortcut,[W.d.nextItem]:this._focusNext,[W.d.previousItem]:this._focusPrevious}},o.createElement(y,{anchoring:t,assumedItemHeight:le(),cacheKey:p,footer:n&&this._renderLoadBottom(),header:a,identityFunction:re,initialAnchor:b&&r.b(re(b)),items:s,nearStartProximityRatio:l,onAtEnd:this._handleAtBottom,onAtStart:this._handleAtTop,onItemsRendered:this._handleItemsRendered,onNearEnd:this._handleNearBottom,onNearStart:this._handleNearTop,onPositionRestored:this._handlePositionRestored,ref:this._setScroller,renderer:this._getCellRenderer(i,_),scrollerDisplayType:d,sortIndexFunction:oe}))))}_renderPill(){const{alert:e,removeAlert:t,topUnseenCount:s,newTweetsPillMode:i,scribeNamespace:n,timelineId:r}=this.props;return i?i===K.a.URT?o.createElement(V.a.Configure,{alert:e,removeAlert:t,scribeNamespace:n,timelineId:r}):i===K.a.CLIENT&&s&&s>0&&N.b.isTrue("responsive_web_tweets_pill_local_enabled")?o.createElement(V.a.Configure,{removeAlert:t,scribeNamespace:n,timelineId:r,unreadCount:s}):void 0:null}_renderActiveCover(){const{activeCover:e}=this.props,t=e&&e.cover;return e&&t?"full"===e.type?this._renderFullCover(e.cover):"half"===e.type?this._renderHalfCover(e.cover):null:null}_renderFullCover(e){const{processCallback:t}=this.props;return o.createElement(D,{details:e.details||void 0,dismissInfo:e.dismissInfo,displayType:e.displayType,image:e.image,imageDisplayType:e.imageDisplayType||void 0,onClose:this._handleDismissCover,onImpression:this._handleCoverImpression,primaryCta:e.primaryCoverCta,primaryText:e.primaryText,processCallback:t,secondaryCta:e.secondaryCoverCta,secondaryText:e.secondaryText,type:"full"})}_renderHalfCover(e){const{processCallback:t}=this.props,s="CenterCover"===e.displayType?"full":"half";return o.createElement(D,{displayType:e.displayType,image:e.coverImage?e.coverImage.image:void 0,imageDisplayType:e.coverImage?e.coverImage.imageDisplayType:void 0,onClose:this._handleDismissCover,onImpression:this._handleCoverImpression,primaryCta:e.primaryCoverCta,primaryText:e.primaryText,processCallback:t,secondaryCta:e.secondaryCoverCta,secondaryText:e.secondaryText,type:s})}_shouldRenderEmptyState(e){const{activeCover:t,initialFetchStatus:s}=this.props,i=s===P.a.LOADED,n=0===e.length;return i&&n&&!t}_getEntryIndex(){return this._createEntryIndex(this.props.entries)}_initialize(){this._scribeNewEntries(this.props.entries),this._activeEntryId=void 0}_flushLingerScribes(){this._scribeLingerEvents(this._impressionTracker.flushLingerEvents())}refreshOrGoTop(){this._scroller&&!this._scroller.isAtTop()?this.scrollToTop():this.props.onRefresh()}_proximityHandler(e){return t=>{this._positionedRestored&&e(t)}}_buildStreamScribeData(e){const{scribeCache:t,timelineId:s,handlerRegistry:i}=this.props;let n=null;if(!t.has(s)){const e=new Set;t.set(s,e)}const r=t.get(s);return r?e.reduce((e,t,s)=>{const{entryId:o}=t;let a=!1;if(t.content&&t.content.promotedMetadata&&(a=t.content.promotedMetadata),!r.has(o)&&!i.getNeedsLoad(t)){r.add(o);const s=this._getScribeDataItem(i,t);s&&(a&&null!==n&&(s.tweet_count=n),e.push(s))}return a?n=0:null!==n&&-1===t.type.indexOf("ui_")&&(n+=1),e},[]):[]}_storeSeenIds(e){const{seenIds:t,seenIdsLatest:s,timelineId:i}=this.props;"home"===i&&t?t.addNewTweets(e):"home-latest"===i&&s&&s.addNewTweets(e)}_scribeLingerEvents(e){if(0===e.length)return;const{handlerRegistry:t}=this.props,s=this._getEntryIndex(),i=[],n=[];if(e.forEach(({id:e,start:r,end:o})=>{const a=s[e];if(a){const e=this._getScribeDataItem(t,a);if(e){const t={visibility_start:r,visibility_end:o};i.push(Object.assign({},e,{impression_details:t}))}a.type===k.b.Tweet&&n.push(a.content.id)}}),i.length>0){const{richScribeAction:e,scribeNamespace:t}=this.props;e(Object.assign({},t,{component:"stream",element:"linger",action:"results"}),{items:i})}n.length>0&&this._storeSeenIds(n)}_getScribeDataItem(e,t){const s=e.getHandler(t);if(s)return s.getScribeDataItem(t)}}n()(de,"contextTypes",{viewport:z.object}),n()(de,"defaultProps",{showFooter:!0,onBottomRetry:A.a,onNearBottom:A.a,onNearTop:A.a,onRefresh:A.a,refreshControl:J.a,scribeCache:ce,scroller:q.b,scrollerDisplayType:Z.a.Vertical,seenIds:Object(ne.b)(),seenIdsLatest:Object(ne.a)(),withKeyboardShortcuts:!0});const pe=ie.a.create(e=>({footer:{height:`calc(5 * ${e.lineHeight}rem)`}}));t.default=de},"n+Zb":function(e,t,s){"use strict";s.d(t,"b",(function(){return i})),s.d(t,"a",(function(){return n}));const i=e=>({id:e,distanceToViewportTop:0}),n=e=>({id:e,distanceToViewportBottom:0})}}]);
//# sourceMappingURL=https://ton.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.TimelineRenderer.a9e0e0c5.js.map