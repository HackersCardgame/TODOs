(window.webpackJsonp=window.webpackJsonp||[]).push([[513],{6010:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=6010},6012:function(e,t,n){parcelRequire=function(t,o,r,s){var i,a="function"==typeof parcelRequire&&parcelRequire;function c(e,r){if(!o[e]){if(!t[e]){var s="function"==typeof parcelRequire&&parcelRequire;if(!r&&s)return s(e,!0);if(a)return a(e,!0);if("string"==typeof e)return n(6010)(e);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}u.resolve=function(n){return t[e][1][n]||n},u.cache={};var l=o[e]=new c.Module(e);t[e][0].call(l.exports,u,l,l.exports,this)}return o[e].exports;function u(e){return c(u.resolve(e))}}c.isParcelRequire=!0,c.Module=function(e){this.id=e,this.bundle=c,this.exports={}},c.modules=t,c.cache=o,c.parent=a,c.register=function(e,n){t[e]=[function(e,t){t.exports=n},{}]};for(var l=0;l<r.length;l++)try{c(r[l])}catch(t){i||(i=t)}if(r.length){var u=c(r[r.length-1]);e.exports=u}if(parcelRequire=c,i)throw i;return c}({l5yF:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AvoInspectorEnv={Prod:"prod",Dev:"dev",Staging:"staging"}},{}],uiqi:[function(e,t,n){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}Object.defineProperty(n,"__esModule",{value:!0});var i=function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return s(e,[{key:"extractSchema",value:function(e){var t=this;return null==e?[]:function e(n){if(i(n)){var r=n.map(function(t){return e(t)});return t.removeDuplicates(r)}if("object"===o(n)){var s=[];for(var a in n)if(n.hasOwnProperty(a)){var c=n[a],l={propertyName:a,propertyType:t.getPropValueType(c)};"object"===o(c)&&null!=c&&(l.children=e(c)),s.push(l)}return s}return t.getPropValueType(n)}(e)}},{key:"removeDuplicates",value:function(e){var t={boolean:{},number:{},string:{}},n=[];return e.filter(function(e){var r=o(e);return r in t?!t[r].hasOwnProperty(e)&&(t[r][e]=!0):!(n.indexOf(e)>=0)&&n.push(e)})}},{key:"getPropValueType",value:function(e){var t=o(e);return null==e?"null":"string"===t?"string":"number"===t||"bigint"===t?(e+"").indexOf(".")>=0?"float":"int":"boolean"===t?"boolean":"object"===t?i(e)?"list":"object":"unknown"}}]),e}();n.AvoSchemaParser=a},{}],zdDo:[function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"newGuid",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}}]),e}();n.default=s},{}],a8rp:[function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var i=s(e("./AvoGuid")),a=e("./AvoInspector"),c=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._lastSessionTimestamp=null,this._sessionLengthMillis=3e5,this.avoBatcher=t}return r(e,[{key:"startOrProlongSession",value:function(t){var n=this;a.AvoInspector.avoStorage.runOnInit(function(){t-n.lastSessionTimestamp>n._sessionLengthMillis&&(e.updateSessionId(),n.avoBatcher.handleSessionStarted()),n._lastSessionTimestamp=t,a.AvoInspector.avoStorage.setItem(e.lastSessionTimestampKey,n._lastSessionTimestamp)})}},{key:"lastSessionTimestamp",get:function(){if(null===this._lastSessionTimestamp||0===this._lastSessionTimestamp){var t=a.AvoInspector.avoStorage.getItem(e.lastSessionTimestampKey);null!=t?(this._lastSessionTimestamp=t,isNaN(this._lastSessionTimestamp)&&(this._lastSessionTimestamp=0)):this._lastSessionTimestamp=0}return this._lastSessionTimestamp}},{key:"sessionLengthMillis",get:function(){return this._sessionLengthMillis}}],[{key:"updateSessionId",value:function(){e._sessionId=i.default.newGuid();try{a.AvoInspector.avoStorage.setItem(e.idCacheKey,e.sessionId)}catch(t){console.error("Avo Inspector: something went very wrong. Please report to support@avo.app.",t)}return e._sessionId}},{key:"sessionId",get:function(){if(null===e._sessionId){if(!a.AvoInspector.avoStorage.initialized)return"unknown";var t=null;try{t=a.AvoInspector.avoStorage.getItem(e.idCacheKey)}catch(r){console.error("Avo Inspector: something went wrong. Please report to support@avo.app.",r)}e._sessionId=null==t?this.updateSessionId():t}return e._sessionId}},{key:"lastSessionTimestampKey",get:function(){return"AvoInspectorSessionTimestamp"}},{key:"idCacheKey",get:function(){return"AvoInspectorSessionId"}}]),e}();n.AvoSessionTracker=c,c._sessionId=null},{"./AvoGuid":"zdDo","./AvoInspector":"proN"}],SFYD:[function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}Object.defineProperty(n,"__esModule",{value:!0});var s=e("./AvoInspector"),i=function(){function e(t){var n=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.events=[],this.networkCallsHandler=t,this.batchFlushAttemptTimestamp=Date.now(),s.AvoInspector.avoStorage.getItemAsync(e.cacheKey).then(function(e){null!==e&&(n.events=n.events.concat(e),n.checkIfBatchNeedsToBeSent())})}return r(e,[{key:"handleSessionStarted",value:function(){this.events.push(this.networkCallsHandler.bodyForSessionStartedCall()),this.saveEvents(),this.checkIfBatchNeedsToBeSent()}},{key:"handleTrackSchema",value:function(e,t){this.events.push(this.networkCallsHandler.bodyForEventSchemaCall(e,t)),this.saveEvents(),s.AvoInspector.shouldLog&&console.log("Avo Inspector: saved event "+e+" with schema "+JSON.stringify(t)),this.checkIfBatchNeedsToBeSent()}},{key:"checkIfBatchNeedsToBeSent",value:function(){var e=this.events.length,t=Date.now(),n=t-this.batchFlushAttemptTimestamp,o=e%s.AvoInspector.batchSize==0,r=n>=1e3*s.AvoInspector.batchFlushSeconds,i=this;if(o||r){this.batchFlushAttemptTimestamp=t;var a=i.events;i.events=[],this.networkCallsHandler.callInspectorWithBatchBody(a,function(e){null!=e?(i.events=i.events.concat(a),s.AvoInspector.shouldLog&&console.log("Avo Inspector: batch sending failed: "+e+". We will attempt to send your schemas with next batch")):s.AvoInspector.shouldLog&&console.log("Avo Inspector: batch sent successfully."),i.saveEvents()})}}},{key:"saveEvents",value:function(){if(this.events.length>1e3){var t=this.events.length-1e3;this.events.splice(0,t)}s.AvoInspector.avoStorage.setItem(e.cacheKey,this.events)}}],[{key:"cacheKey",get:function(){return"AvoInspectorEvents"}}]),e}();n.AvoBatcher=i},{"./AvoInspector":"proN"}],KiUt:[function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var i=s(e("./AvoGuid")),a=e("./AvoInspector"),c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"getInstallationId",value:function(){if(null!==e.installationId)return e.installationId;if(!a.AvoInspector.avoStorage.initialized)return"unknown";var t=a.AvoInspector.avoStorage.getItem(e.cacheKey);return null==t?(e.installationId=i.default.newGuid(),a.AvoInspector.avoStorage.setItem(e.cacheKey,e.installationId)):e.installationId=t,e.installationId}},{key:"cacheKey",get:function(){return"AvoInstallationId"}}]),e}();n.AvoInstallationId=c,c.installationId=null},{"./AvoGuid":"zdDo","./AvoInspector":"proN"}],Oe2B:[function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var i=s(e("./AvoGuid")),a=e("./AvoSessionTracker"),c=e("./AvoInspector"),l=e("./AvoInstallationId"),u=function(){function e(t,n,o,r,s){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.samplingRate=1,this.sending=!1,this.apiKey=t,this.envName=n,this.appName=o,this.appVersion=r,this.libVersion=s}return r(e,[{key:"callInspectorWithBatchBody",value:function(t,n){var o=this;if(this.sending)n("Batch sending cancelled because another batch sending is in progress. Your events will be sent with next batch.");else if(0!==t.length)if(Math.random()>this.samplingRate)c.AvoInspector.shouldLog&&console.log("Avo Inspector: last event schema dropped due to sampling rate.");else{c.AvoInspector.shouldLog&&t.forEach(function(e){if("sessionStarted"===e.type)console.log("Avo Inspector: sending session started event.");else if("event"===e.type){var t=e;console.log("Avo Inspector: sending event "+t.eventName+" with schema "+JSON.stringify(t.eventProperties))}}),this.sending=!0;var r=new XMLHttpRequest;r.open("POST",e.trackingEndpoint,!0),r.setRequestHeader("Content-Type","text/plain"),r.send(JSON.stringify(t)),r.onload=function(){if(200!=r.status)n("Error ".concat(r.status,": ").concat(r.statusText));else{var e=JSON.parse(r.response).samplingRate;void 0!==e&&(o.samplingRate=e),n(null)}},r.onerror=function(){n("Request failed")},r.ontimeout=function(){n("Request timed out")},this.sending=!1}}},{key:"bodyForSessionStartedCall",value:function(){var e=this.createBaseCallBody();return e.type="sessionStarted",e}},{key:"bodyForEventSchemaCall",value:function(e,t){var n=this.createBaseCallBody();return n.type="event",n.eventName=e,n.eventProperties=t,n}},{key:"createBaseCallBody",value:function(){return{apiKey:this.apiKey,appName:this.appName,appVersion:this.appVersion,libVersion:this.libVersion,env:this.envName,libPlatform:"web",messageId:i.default.newGuid(),trackingId:l.AvoInstallationId.getInstallationId(),createdAt:(new Date).toISOString(),sessionId:a.AvoSessionTracker.sessionId,samplingRate:this.samplingRate}}}]),e}();n.AvoNetworkCallsHandler=u,u.trackingEndpoint="https://api.avo.app/inspector/v1/track"},{"./AvoGuid":"zdDo","./AvoSessionTracker":"a8rp","./AvoInspector":"proN","./AvoInstallationId":"KiUt"}],TSkk:[function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.data={},this.reactNative=null,this.Platform=null,this.AsyncStorage=null,this.initialized=!1,this.onInitFuncs=[],this.getItem=function(e){var t;return"undefined"!=typeof window&&(t=window.localStorage.getItem(e)),null!=t?JSON.parse(t):null},this.setItem=function(e,t){"undefined"!=typeof window&&window.localStorage.setItem(e,JSON.stringify(t))},this.removeItem=function(e){"undefined"!=typeof window&&window.localStorage.removeItem(e)},this.initialized=!0}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(e,[{key:"runOnInit",value:function(e){!0===this.initialized?e():this.onInitFuncs.push(e)}},{key:"getItemAsync",value:function(e){var t;return"undefined"!=typeof window&&null!=(t=window.localStorage.getItem(e))?Promise.resolve(JSON.parse(t)):Promise.resolve(null)}}]),e}();n.AvoStorage=r},{}],EHrm:[function(e,t,n){t.exports={name:"avo-inspector",version:"1.0.4",description:"",main:"dist/index.js",browser:"dist/index.js","react-native":"dist-native/index.js",types:"dist/index.d.ts",scripts:{build:"tsc --emitDeclarationOnly && BROWSER=1 parcel build src/index.ts","build-native":"tsc --outDir dist-native",dev:"parcel src/index.ts",test:"jest",typecheck:"tsc --noEmit",commit:"git-cz",release:"release-it"},repository:{type:"git",url:"git+https://github.com/avohq/web-avo-inspector.git"},jest:{transform:{".(ts|tsx)":"ts-jest"},testPathIgnorePatterns:["node_modules","examples"],testRegex:"(/__tests__/.*|\\.(test|spec))\\.(ts|tsx|js)$",moduleFileExtensions:["ts","tsx","js"]},keywords:["web","analytics","avo","react","react-native","node","javascript"],author:"Avo (https://www.avo.app)",license:"MIT",bugs:{url:"https://github.com/avohq/web-avo-inspector/issues"},homepage:"https://github.com/avohq/web-avo-inspector#readme",devDependencies:{"@babel/core":"7.9.0","@types/jest":"25.2.1","@types/node":"13.13.5","babel-preset-es2015":"6.24.1","babel-preset-react":"6.24.1",jest:"^25.4.0","parcel-bundler":"1.12.4","parcel-plugin-externals":"0.4.0",prettier:"2.0.5","ts-jest":"25.4.0",typescript:"^3.8.3",commitizen:"3.0.5","conventional-changelog-cli":"2.0.11","cz-conventional-changelog":"2.1.0",eslint:"^6.8.0","eslint-plugin-react":"^7.18.0","prettier-eslint":"^9.0.1","release-it":"8.2.0"},externals:["react-native"],config:{commitizen:{path:"cz-conventional-changelog"}}}},{}],proN:[function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}Object.defineProperty(n,"__esModule",{value:!0});var s=e("./AvoInspectorEnv"),i=e("./AvoSchemaParser"),a=e("./AvoSessionTracker"),c=e("./AvoBatcher"),l=e("./AvoNetworkCallsHandler"),u=e("./AvoStorage"),v=e("../package.json").version,p=function(){function e(t){var n=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),null===t.env||void 0===t.env?(this.environment=s.AvoInspectorEnv.Dev,console.warn("[Avo Inspector] No environment provided. Defaulting to dev.")):this.environment=t.env,null===t.apiKey||void 0===t.apiKey||0==t.apiKey.trim().length)throw new Error("[Avo Inspector] No API key provided. Inspector can't operate without API key.");if(this.apiKey=t.apiKey,null===t.version||void 0===t.version||0==t.version.trim().length)throw new Error("[Avo Inspector] No version provided. Many features of Inspector rely on versioning. Please provide comparable string version, i.e. integer or semantic.");this.version=t.version,this.environment===s.AvoInspectorEnv.Dev?(e._batchFlushSeconds=1,e._shouldLog=!0):(e._batchFlushSeconds=30,e._shouldLog=!1),e.avoStorage=new u.AvoStorage;var o=new l.AvoNetworkCallsHandler(this.apiKey,this.environment.toString(),t.appName||"",this.version,v);this.avoBatcher=new c.AvoBatcher(o),this.sessionTracker=new a.AvoSessionTracker(this.avoBatcher);try{"undefined"!=typeof window&&window.addEventListener("load",function(){n.sessionTracker.startOrProlongSession(Date.now())},!1)}catch(r){console.error("Avo Inspector: something went very wrong. Please report to support@avo.app.",r)}}return r(e,[{key:"trackSchemaFromEvent",value:function(t,n){try{e.shouldLog&&console.log("Avo Inspector: supplied event "+t+" with params "+JSON.stringify(n));var o=this.extractSchema(n);this.trackSchema(t,o)}catch(i){console.error("Avo Inspector: something went very wrong. Please report to support@avo.app.",i)}}},{key:"trackSchema",value:function(e,t){try{this.sessionTracker.startOrProlongSession(Date.now()),this.avoBatcher.handleTrackSchema(e,t)}catch(r){console.error("Avo Inspector: something went very wrong. Please report to support@avo.app.",r)}}},{key:"enableLogging",value:function(t){e._shouldLog=t}},{key:"extractSchema",value:function(t){try{return this.sessionTracker.startOrProlongSession(Date.now()),(new i.AvoSchemaParser).extractSchema(t)}catch(e){return console.error("Avo Inspector: something went very wrong. Please report to support@avo.app.",e),[]}}},{key:"setBatchSize",value:function(t){e._batchSize=t}},{key:"setBatchFlushSeconds",value:function(t){e._batchFlushSeconds=t}}],[{key:"batchSize",get:function(){return this._batchSize}},{key:"batchFlushSeconds",get:function(){return this._batchFlushSeconds}},{key:"shouldLog",get:function(){return this._shouldLog}}]),e}();n.AvoInspector=p,p._batchSize=30,p._batchFlushSeconds=30,p._shouldLog=!1},{"./AvoInspectorEnv":"l5yF","./AvoSchemaParser":"uiqi","./AvoSessionTracker":"a8rp","./AvoBatcher":"SFYD","./AvoNetworkCallsHandler":"Oe2B","./AvoStorage":"TSkk","../package.json":"EHrm"}],QCba:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./AvoInspector");n.AvoInspector=o.AvoInspector;var r=e("./AvoInspectorEnv");n.AvoInspectorEnv=r.AvoInspectorEnv},{"./AvoInspector":"proN","./AvoInspectorEnv":"l5yF"}]},{},["QCba"])}}]);
//# sourceMappingURL=513.223bac10.chunk.js.map